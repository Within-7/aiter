<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AiTer - AI CLI åä½œç»ˆç«¯</title>
  <style>
    :root {
      --primary: #667eea;
      --primary-dark: #5a67d8;
      --secondary: #764ba2;
      --bg-dark: #1a1a2e;
      --bg-card: #16213e;
      --text: #eaeaea;
      --text-muted: #a0a0a0;
      --success: #48bb78;
      --border: #2d3748;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 80px 20px 60px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    }

    .logo {
      font-size: 72px;
      font-weight: 800;
      margin-bottom: 16px;
      letter-spacing: -2px;
    }

    .tagline {
      font-size: 24px;
      opacity: 0.95;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 16px;
      opacity: 0.8;
    }

    .version-badge {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 8px 20px;
      border-radius: 20px;
      margin-top: 20px;
      font-size: 14px;
      backdrop-filter: blur(10px);
    }

    /* Main Content */
    .main {
      padding: 60px 0;
    }

    .section {
      margin-bottom: 60px;
    }

    .section-title {
      font-size: 28px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Download Cards */
    .download-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
    }

    .download-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      transition: all 0.3s ease;
    }

    .download-card:hover {
      border-color: var(--primary);
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }

    .platform-icon {
      font-size: 36px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    .card-desc {
      color: var(--text-muted);
      font-size: 14px;
      margin-bottom: 20px;
    }

    .download-btn {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 14px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      transition: all 0.3s ease;
    }

    .download-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .download-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .file-meta {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* CLI Installation */
    .cli-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
    }

    .cli-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .cli-tab {
      padding: 10px 18px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .cli-tab:hover {
      border-color: var(--primary);
      color: var(--text);
    }

    .cli-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .cli-content {
      display: none;
    }

    .cli-content.active {
      display: block;
    }

    .code-block {
      background: #0d1117;
      border-radius: 10px;
      padding: 20px;
      position: relative;
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      font-family: 'SF Mono', 'Fira Code', Consolas, monospace;
      font-size: 13px;
      line-height: 1.7;
      color: #c9d1d9;
    }

    .code-block .comment {
      color: #8b949e;
    }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(255,255,255,0.1);
      border: none;
      color: #8b949e;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .copy-btn.copied {
      background: var(--success);
      color: white;
    }

    /* Features */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .feature-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }

    .feature-icon {
      font-size: 28px;
      margin-bottom: 12px;
    }

    .feature-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .feature-desc {
      font-size: 14px;
      color: var(--text-muted);
    }

    /* Requirements */
    .requirements {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }

    .requirements ul {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .requirements li {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .requirements li::before {
      content: "âœ“";
      color: var(--success);
      font-weight: bold;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 40px 20px;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 14px;
    }

    .footer a {
      color: var(--primary);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
    }

    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 2px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Error State */
    .error-msg {
      background: rgba(245, 101, 101, 0.1);
      border: 1px solid rgba(245, 101, 101, 0.3);
      border-radius: 8px;
      padding: 16px;
      color: #fc8181;
      text-align: center;
    }

    .error-msg a {
      color: #fc8181;
    }

    .hidden {
      display: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        padding: 60px 20px 40px;
      }

      .logo {
        font-size: 48px;
      }

      .tagline {
        font-size: 18px;
      }

      .section-title {
        font-size: 22px;
      }

      .download-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <h1 class="logo">AiTer</h1>
      <p class="tagline">AI CLI åä½œç»ˆç«¯</p>
      <p class="subtitle">ä¸“ä¸º Claude Codeã€Gemini CLIã€Minto ç­‰ AI å·¥å…·ä¼˜åŒ–</p>
      <div class="version-badge" id="version-badge">
        <span class="spinner"></span> åŠ è½½ä¸­...
      </div>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <!-- Download Section -->
      <section class="section">
        <h2 class="section-title">ğŸ“¥ ä¸‹è½½å®‰è£…</h2>

        <!-- Loading State -->
        <div id="loading-state" class="loading">
          <span class="spinner"></span> æ­£åœ¨è·å–æœ€æ–°ç‰ˆæœ¬...
        </div>

        <!-- Error State -->
        <div id="error-state" class="error-msg hidden">
          æ— æ³•è·å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯·ç¨åé‡è¯•æˆ–è®¿é—®
          <a href="https://github.com/Within-7/aiter/releases" target="_blank">GitHub Releases</a>
        </div>

        <!-- Download Cards -->
        <div id="download-cards" class="download-grid hidden">
          <!-- macOS Apple Silicon -->
          <div class="download-card">
            <div class="card-header">
              <span class="platform-icon">ğŸ</span>
              <div>
                <div class="card-title">macOS (Apple Silicon)</div>
                <div class="card-subtitle">M1 / M2 / M3 / M4 èŠ¯ç‰‡</div>
              </div>
            </div>
            <p class="card-desc">é€‚ç”¨äºæ­è½½ Apple Silicon èŠ¯ç‰‡çš„ Mac ç”µè„‘</p>
            <a id="btn-mac-arm" href="#" class="download-btn">ä¸‹è½½ DMG</a>
            <div class="file-meta">
              <span id="name-mac-arm">-</span>
              <span id="size-mac-arm">-</span>
            </div>
          </div>

          <!-- macOS Intel -->
          <div class="download-card">
            <div class="card-header">
              <span class="platform-icon">ğŸ’»</span>
              <div>
                <div class="card-title">macOS (Intel)</div>
                <div class="card-subtitle">Intel èŠ¯ç‰‡</div>
              </div>
            </div>
            <p class="card-desc">é€‚ç”¨äºæ­è½½ Intel èŠ¯ç‰‡çš„ Mac ç”µè„‘</p>
            <a id="btn-mac-intel" href="#" class="download-btn">ä¸‹è½½ DMG</a>
            <div class="file-meta">
              <span id="name-mac-intel">-</span>
              <span id="size-mac-intel">-</span>
            </div>
          </div>

          <!-- Windows -->
          <div class="download-card">
            <div class="card-header">
              <span class="platform-icon">ğŸªŸ</span>
              <div>
                <div class="card-title">Windows</div>
                <div class="card-subtitle">64 ä½</div>
              </div>
            </div>
            <p class="card-desc">é€‚ç”¨äº Windows 10 åŠä»¥ä¸Šç‰ˆæœ¬</p>
            <a id="btn-win" href="#" class="download-btn">ä¸‹è½½ EXE</a>
            <div class="file-meta">
              <span id="name-win">-</span>
              <span id="size-win">-</span>
            </div>
          </div>
        </div>
      </section>

      <!-- CLI Installation -->
      <section class="section">
        <h2 class="section-title">ğŸ’» å‘½ä»¤è¡Œå®‰è£…ï¼ˆæ¨è / Recommendedï¼‰</h2>

        <!-- One-Click Install (Recommended) -->
        <div class="cli-section">
          <h3 style="color: var(--success); margin-bottom: 16px;">âœ¨ ä¸€é”®å®‰è£…ï¼ˆæ¨è / Recommendedï¼‰</h3>
          <p style="color: var(--text-muted); margin-bottom: 16px;">
            ä½¿ç”¨è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼Œè‡ªåŠ¨å¤„ç†ç³»ç»Ÿæ£€æµ‹ã€ä¸‹è½½å’Œæƒé™é—®é¢˜<br>
            Use the automatic installation script that handles system detection, download, and permissions
          </p>

          <h4 style="margin-top: 24px; margin-bottom: 12px;">macOS / Linux</h4>
          <div class="code-block">
            <button class="copy-btn" data-target="code-auto-install-mac">å¤åˆ¶</button>
            <pre id="code-auto-install-mac"><span class="comment"># ä¸€é”®å®‰è£… / One-click install</span>
curl -fsSL https://raw.githubusercontent.com/Within-7/aiter/main/scripts/install.sh | bash</pre>
          </div>
          <p style="color: var(--text-muted); margin-top: 8px; font-size: 14px;">
            è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿæ¶æ„ï¼ˆApple Silicon æˆ– Intelï¼‰å¹¶å®‰è£…å¯¹åº”ç‰ˆæœ¬<br>
            Automatically detects system architecture (Apple Silicon or Intel) and installs the correct version
          </p>

          <h4 style="margin-top: 32px; margin-bottom: 12px;">Windows</h4>
          <div class="code-block">
            <button class="copy-btn" data-target="code-auto-install-win">å¤åˆ¶</button>
            <pre id="code-auto-install-win"><span class="comment"># ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell / Run PowerShell as Administrator</span>
irm https://raw.githubusercontent.com/Within-7/aiter/main/scripts/install.ps1 | iex</pre>
          </div>
          <p style="color: var(--text-muted); margin-top: 8px; font-size: 14px;">
            è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬ / Automatically downloads and installs the latest version<br>
            <strong>æ³¨æ„ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™ / Note: Requires administrator privileges</strong>
          </p>
        </div>

        <h3 style="margin-top: 48px; margin-bottom: 16px; color: var(--text-muted);">æ‰‹åŠ¨å®‰è£… / Manual Installation</h3>
        <div class="cli-section">
          <div class="cli-tabs">
            <button class="cli-tab active" data-tab="mac-arm">macOS (Apple Silicon)</button>
            <button class="cli-tab" data-tab="mac-intel">macOS (Intel)</button>
            <button class="cli-tab" data-tab="win">Windows</button>
            <button class="cli-tab" data-tab="win-silent">Windows (é™é»˜)</button>
          </div>

          <div id="cli-mac-arm" class="cli-content active">
            <div class="code-block">
              <button class="copy-btn" data-target="code-mac-arm">å¤åˆ¶</button>
              <pre id="code-mac-arm"><span class="comment"># ä¸‹è½½å¹¶å®‰è£… AiTer (Apple Silicon)</span>
curl -fsSL "<span id="url-mac-arm">https://github.com/Within-7/aiter/releases/latest</span>" -o /tmp/AiTer.dmg
hdiutil attach /tmp/AiTer.dmg -mountpoint /tmp/AiTer-mount
cp -R "/tmp/AiTer-mount/AiTer.app" /Applications/
hdiutil detach /tmp/AiTer-mount
rm /tmp/AiTer.dmg
echo "AiTer å·²å®‰è£…åˆ° /Applications"</pre>
            </div>
          </div>

          <div id="cli-mac-intel" class="cli-content">
            <div class="code-block">
              <button class="copy-btn" data-target="code-mac-intel">å¤åˆ¶</button>
              <pre id="code-mac-intel"><span class="comment"># ä¸‹è½½å¹¶å®‰è£… AiTer (Intel)</span>
curl -fsSL "<span id="url-mac-intel">https://github.com/Within-7/aiter/releases/latest</span>" -o /tmp/AiTer.dmg
hdiutil attach /tmp/AiTer.dmg -mountpoint /tmp/AiTer-mount
cp -R "/tmp/AiTer-mount/AiTer.app" /Applications/
hdiutil detach /tmp/AiTer-mount
rm /tmp/AiTer.dmg
echo "AiTer å·²å®‰è£…åˆ° /Applications"</pre>
            </div>
          </div>

          <div id="cli-win" class="cli-content">
            <div class="code-block">
              <button class="copy-btn" data-target="code-win">å¤åˆ¶</button>
              <pre id="code-win"><span class="comment"># PowerShell: ä¸‹è½½å¹¶å®‰è£… AiTer</span>
$url = "<span id="url-win">https://github.com/Within-7/aiter/releases/latest</span>"
$installer = "$env:TEMP\AiTer-Setup.exe"
Invoke-WebRequest -Uri $url -OutFile $installer
Start-Process -FilePath $installer -Wait
Remove-Item $installer
Write-Host "AiTer å®‰è£…å®Œæˆ"</pre>
            </div>
          </div>

          <div id="cli-win-silent" class="cli-content">
            <div class="code-block">
              <button class="copy-btn" data-target="code-win-silent">å¤åˆ¶</button>
              <pre id="code-win-silent"><span class="comment"># PowerShell: é™é»˜å®‰è£…ï¼ˆæ—  UIï¼‰</span>
$url = "<span id="url-win-silent">https://github.com/Within-7/aiter/releases/latest</span>"
$installer = "$env:TEMP\AiTer-Setup.exe"
Invoke-WebRequest -Uri $url -OutFile $installer
Start-Process -FilePath $installer -ArgumentList "/S" -Wait
Remove-Item $installer
Write-Host "AiTer é™é»˜å®‰è£…å®Œæˆ"</pre>
            </div>
          </div>
        </div>
      </section>

      <!-- Features -->
      <section class="section">
        <h2 class="section-title">âœ¨ æ ¸å¿ƒåŠŸèƒ½</h2>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ¤–</div>
            <h3 class="feature-title">AI CLI ä¼˜åŒ–</h3>
            <p class="feature-desc">ä¸“ä¸º Claude Codeã€Gemini CLI ç­‰ AI å‘½ä»¤è¡Œå·¥å…·è®¾è®¡ï¼Œæä¾›æœ€ä½³äº¤äº’ä½“éªŒ</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ“</div>
            <h3 class="feature-title">å¤šé¡¹ç›®ç®¡ç†</h3>
            <p class="feature-desc">è½»æ¾ç®¡ç†å¤šä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹çš„ç»ˆç«¯ç¯å¢ƒå’Œæ–‡ä»¶æµè§ˆå™¨</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ–¥ï¸</div>
            <h3 class="feature-title">å¤šç»ˆç«¯æ ‡ç­¾</h3>
            <p class="feature-desc">åœ¨å•ä¸ªé¡¹ç›®å†…åˆ›å»ºå¤šä¸ªç»ˆç«¯ï¼ŒåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸŒ</div>
            <h3 class="feature-title">HTML å®æ—¶é¢„è§ˆ</h3>
            <p class="feature-desc">å†…ç½®æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ”¯æŒ HTML å’Œ Markdown å®æ—¶é¢„è§ˆ</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ“</div>
            <h3 class="feature-title">Monaco ç¼–è¾‘å™¨</h3>
            <p class="feature-desc">é›†æˆ VS Code åŒæ¬¾ç¼–è¾‘å™¨ï¼Œæ”¯æŒè¯­æ³•é«˜äº®å’Œæ™ºèƒ½æç¤º</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ”„</div>
            <h3 class="feature-title">è‡ªåŠ¨æ›´æ–°</h3>
            <p class="feature-desc">å†…ç½®æ›´æ–°æ£€æµ‹ï¼Œä¸€é”®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬</p>
          </div>
        </div>
      </section>

      <!-- System Requirements -->
      <section class="section">
        <h2 class="section-title">ğŸ’¡ ç³»ç»Ÿè¦æ±‚</h2>
        <div class="requirements">
          <ul>
            <li>macOS 10.12 (Sierra) æˆ–æ›´é«˜ç‰ˆæœ¬</li>
            <li>Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
            <li>æœ€ä½ 4GB å†…å­˜ï¼Œæ¨è 8GB</li>
            <li>500MB å¯ç”¨ç£ç›˜ç©ºé—´</li>
          </ul>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>Copyright Â© 2025-2026 <a href="https://within-7.com" target="_blank">Within-7.com</a></p>
      <p style="margin-top: 8px;">
        <a href="https://github.com/Within-7/aiter" target="_blank">GitHub</a> Â·
        <a href="mailto:dev@within-7.com">è”ç³»æˆ‘ä»¬</a>
      </p>
    </div>
  </footer>

  <script>
    const GITHUB_REPO = 'Within-7/aiter';
    const GITHUB_API = 'https://api.github.com/repos/' + GITHUB_REPO + '/releases/latest';
    const GITHUB_RELEASES_URL = 'https://github.com/' + GITHUB_REPO + '/releases/latest';

    // é™æ€ fallback - å½“æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥æ—¶ä½¿ç”¨ï¼ˆå°¤å…¶æ˜¯ file:// åè®®ï¼‰
    // æ³¨æ„ï¼šæ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬åéœ€è¦æ›´æ–°æ­¤æ•°æ®
    const FALLBACK_RELEASE = {
      tag_name: 'v0.1.21',
      published_at: '2025-12-24T00:00:00Z',
      assets: [
        {
          name: 'AiTer-0.1.21-mac-arm64.dmg',
          size: 252500000,
          browser_download_url: 'https://github.com/Within-7/aiter/releases/download/v0.1.21/AiTer-0.1.21-mac-arm64.dmg'
        },
        {
          name: 'AiTer-0.1.21-mac-x64.dmg',
          size: 257400000,
          browser_download_url: 'https://github.com/Within-7/aiter/releases/download/v0.1.21/AiTer-0.1.21-mac-x64.dmg'
        },
        {
          name: 'AiTer-0.1.21-win-x64.exe',
          size: 116900000,
          browser_download_url: 'https://github.com/Within-7/aiter/releases/download/v0.1.21/AiTer-0.1.21-win-x64.exe'
        }
      ]
    };

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // é€šè¿‡ redirect è·å–ç‰ˆæœ¬å·ï¼ˆé¿å… API é™æµï¼‰
    async function getVersionFromRedirect() {
      try {
        // ä½¿ç”¨ HEAD è¯·æ±‚è·å–é‡å®šå‘ URLï¼Œä¸è·Ÿéšé‡å®šå‘
        const res = await fetch(GITHUB_RELEASES_URL, {
          method: 'HEAD',
          redirect: 'manual'
        });

        // ä» redirect URL ä¸­æå–ç‰ˆæœ¬å·
        const redirectUrl = res.headers.get('location');
        if (redirectUrl) {
          const match = redirectUrl.match(/\/tag\/v?(.+)$/);
          if (match) {
            return match[1];
          }
        }
      } catch (err) {
        console.log('Redirect method failed:', err);
      }
      return null;
    }

    // æ„å»º release å¯¹è±¡ï¼ˆåŸºäºç‰ˆæœ¬å·ï¼Œä¸éœ€è¦ APIï¼‰
    function buildReleaseFromVersion(version) {
      return {
        tag_name: 'v' + version,
        published_at: new Date().toISOString(),
        assets: [
          {
            name: 'AiTer-' + version + '-mac-arm64.dmg',
            size: 0, // æœªçŸ¥å¤§å°
            browser_download_url: 'https://github.com/' + GITHUB_REPO + '/releases/download/v' + version + '/AiTer-' + version + '-mac-arm64.dmg'
          },
          {
            name: 'AiTer-' + version + '-mac-x64.dmg',
            size: 0,
            browser_download_url: 'https://github.com/' + GITHUB_REPO + '/releases/download/v' + version + '/AiTer-' + version + '-mac-x64.dmg'
          },
          {
            name: 'AiTer-' + version + '-win-x64.exe',
            size: 0,
            browser_download_url: 'https://github.com/' + GITHUB_REPO + '/releases/download/v' + version + '/AiTer-' + version + '-win-x64.exe'
          }
        ],
        isConstructed: true
      };
    }

    // è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
    // ä¼˜å…ˆä½¿ç”¨ redirect æ–¹å¼ï¼ˆé¿å… API é™æµï¼‰ï¼Œå¤±è´¥æ—¶å›é€€åˆ° APIï¼Œæœ€åä½¿ç”¨é™æ€ fallback
    async function fetchLatestRelease() {
      // å¦‚æœæ˜¯ file:// åè®®ï¼Œç›´æ¥ä½¿ç”¨ fallbackï¼ˆæ— æ³•å‘èµ· CORS è¯·æ±‚ï¼‰
      if (window.location.protocol === 'file:') {
        return { ...FALLBACK_RELEASE, isFallback: true };
      }

      // 1. é¦–å…ˆå°è¯• redirect æ–¹å¼ï¼ˆä¸æ¶ˆè€— API é…é¢ï¼‰
      const version = await getVersionFromRedirect();
      if (version) {
        console.log('Got version from redirect:', version);
        // å°è¯•ç”¨ API è·å–å®Œæ•´ä¿¡æ¯ï¼ˆç”¨äºæ–‡ä»¶å¤§å°ç­‰ï¼‰
        try {
          const res = await fetch(GITHUB_API);
          if (res.ok) {
            const data = await res.json();
            // éªŒè¯ç‰ˆæœ¬åŒ¹é…
            if (data.tag_name === 'v' + version || data.tag_name === version) {
              return data;
            }
          }
        } catch (err) {
          console.log('API failed, using constructed release');
        }
        // API å¤±è´¥æ—¶ï¼Œä½¿ç”¨æ„å»ºçš„ release å¯¹è±¡
        return buildReleaseFromVersion(version);
      }

      // 2. Redirect å¤±è´¥ï¼Œå°è¯• API
      try {
        const res = await fetch(GITHUB_API);
        if (!res.ok) throw new Error('Failed to fetch release');
        return await res.json();
      } catch (err) {
        console.error('Error fetching release:', err);
        return { ...FALLBACK_RELEASE, isFallback: true };
      }
    }

    // è§£æèµ„æºæ–‡ä»¶
    function parseAssets(assets) {
      const result = { macArm: null, macIntel: null, win: null };

      for (const asset of assets) {
        const name = asset.name.toLowerCase();
        if (name.includes('mac') && name.includes('arm64') && name.endsWith('.dmg')) {
          result.macArm = asset;
        } else if (name.includes('mac') && name.includes('x64') && name.endsWith('.dmg')) {
          result.macIntel = asset;
        } else if (name.includes('win') && name.endsWith('.exe')) {
          result.win = asset;
        }
      }

      return result;
    }

    // æ›´æ–°ä¸‹è½½æŒ‰é’®å’Œä¿¡æ¯
    function updateDownloadCard(prefix, asset) {
      const btn = document.getElementById('btn-' + prefix);
      const nameEl = document.getElementById('name-' + prefix);
      const sizeEl = document.getElementById('size-' + prefix);

      if (asset) {
        btn.href = asset.browser_download_url;
        btn.classList.remove('disabled');
        nameEl.textContent = asset.name;
        // å¦‚æœæ–‡ä»¶å¤§å°ä¸º 0ï¼ˆä» redirect æ„å»ºçš„ï¼‰ï¼Œæ˜¾ç¤º "-"
        sizeEl.textContent = asset.size > 0 ? formatSize(asset.size) : '-';
      } else {
        btn.removeAttribute('href');
        btn.classList.add('disabled');
        nameEl.textContent = 'æš‚æ— ';
        sizeEl.textContent = '-';
      }
    }

    // æ›´æ–° CLI å‘½ä»¤ä¸­çš„ URL
    function updateCliUrl(id, url) {
      const el = document.getElementById(id);
      if (el && url) {
        el.textContent = url;
      }
    }

    // åˆå§‹åŒ–
    async function init() {
      const loadingState = document.getElementById('loading-state');
      const errorState = document.getElementById('error-state');
      const downloadCards = document.getElementById('download-cards');
      const versionBadge = document.getElementById('version-badge');

      const release = await fetchLatestRelease();

      // ç”±äº fallback æœºåˆ¶ï¼Œrelease æ°¸è¿œä¸ä¼šä¸º null
      // ä¿ç•™é”™è¯¯å¤„ç†ä»¥é˜²ä¸‡ä¸€
      if (!release) {
        loadingState.classList.add('hidden');
        errorState.classList.remove('hidden');
        versionBadge.textContent = 'ç‰ˆæœ¬è·å–å¤±è´¥';
        return;
      }

      const version = release.tag_name.replace('v', '');
      const assets = parseAssets(release.assets);

      // æ›´æ–°ç‰ˆæœ¬å¾½ç« 
      const releaseDate = new Date(release.published_at).toLocaleDateString('zh-CN');
      if (release.isFallback) {
        versionBadge.textContent = 'v' + version + ' Â· ' + releaseDate + ' (ç¼“å­˜ç‰ˆæœ¬)';
      } else {
        versionBadge.textContent = 'v' + version + ' Â· ' + releaseDate;
      }

      // æ›´æ–°ä¸‹è½½å¡ç‰‡
      updateDownloadCard('mac-arm', assets.macArm);
      updateDownloadCard('mac-intel', assets.macIntel);
      updateDownloadCard('win', assets.win);

      // æ›´æ–° CLI URL
      if (assets.macArm) {
        updateCliUrl('url-mac-arm', assets.macArm.browser_download_url);
      }
      if (assets.macIntel) {
        updateCliUrl('url-mac-intel', assets.macIntel.browser_download_url);
      }
      if (assets.win) {
        updateCliUrl('url-win', assets.win.browser_download_url);
        updateCliUrl('url-win-silent', assets.win.browser_download_url);
      }

      // æ˜¾ç¤ºä¸‹è½½å¡ç‰‡
      loadingState.classList.add('hidden');
      downloadCards.classList.remove('hidden');
    }

    // CLI æ ‡ç­¾åˆ‡æ¢
    document.querySelectorAll('.cli-tab').forEach(function(tab) {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.cli-tab').forEach(function(t) {
          t.classList.remove('active');
        });
        document.querySelectorAll('.cli-content').forEach(function(c) {
          c.classList.remove('active');
        });

        tab.classList.add('active');
        document.getElementById('cli-' + tab.dataset.tab).classList.add('active');
      });
    });

    // å¤åˆ¶æŒ‰é’®
    document.querySelectorAll('.copy-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var targetId = btn.dataset.target;
        var code = document.getElementById(targetId).textContent;

        navigator.clipboard.writeText(code).then(function() {
          btn.textContent = 'å·²å¤åˆ¶!';
          btn.classList.add('copied');

          setTimeout(function() {
            btn.textContent = 'å¤åˆ¶';
            btn.classList.remove('copied');
          }, 2000);
        }).catch(function() {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        });
      });
    });

    // å¯åŠ¨
    init();
  </script>
</body>
</html>
